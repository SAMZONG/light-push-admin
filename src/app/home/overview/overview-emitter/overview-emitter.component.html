<nav md-tab-nav-bar>
  <a md-tab-link [active]="currTab == 'push'" (click)="currTab = 'push'">推送数据</a>
  <a md-tab-link [active]="currTab == 'report'" (click)="currTab = 'report'">推送报告</a>
  <a md-tab-link [active]="currTab == 'simulate'" (click)="currTab = 'simulate'">模拟客户端</a>
</nav>

<form (ngSubmit)="sendMessage()" autocomplete="off" *ngIf="currTab == 'push'" #sendMessageForm="ngForm">

  <md-input-container>
    <input type="text" mdInput [(ngModel)]="messageForm.room" name="room" color="warn" placeholder="输入房间名" required>
    <md-error>必填</md-error>
  </md-input-container>

  <md-input-container>
    <textarea mdInput rows="7" [(ngModel)]="messageForm.pushData" name="pushData" placeholder="输入推送数据" required></textarea>
    <md-error>必填</md-error>
    <md-hint>必须是JSON字符串</md-hint>
  </md-input-container>

  <md-input-container>
    <input type="text" mdInput [(ngModel)]="messageForm.apnsName" name="apnsName" placeholder="输入apnsName">
  </md-input-container>

  <div style="text-align: right;">
    <md-slide-toggle checked="messageForm.leaveMessage" color="accent" name="leaveMessage" [(ngModel)]="messageForm.leaveMessage">离线保存</md-slide-toggle>
    <button type="submit" [disabled]="sendMessageForm.form.invalid" md-raised-button color="accent">发送</button>
  </div>

  <div class="toggle-to-report" *ngIf="sendId">
    <a (click)="toggleToReport()">
      查看推送报告(id:{{sendId}})
    </a>
  </div>
</form>


<form (ngSubmit)="report()" autocomplete="off" *ngIf="currTab == 'report'">
  <md-input-container>
    <input type="text" mdInput [(ngModel)]="reportMessageId" name="reportMessageId" color="warn" placeholder="输入消息ID查询" required>
    <button type="submit" md-raised-button [disabled]="!reportMessageId" color="accent" mdSuffix>查看</button>
    <md-error>必填</md-error>
  </md-input-container>

  <textarea rows="20" readonly disabled name="reportMessage" [(ngModel)]="reportMessage"></textarea>
</form>

<div *ngIf="currTab == 'simulate'">
  <form (ngSubmit)="connect()" #conectionForm="ngForm">
    <div [hidden]="socketService.ready">

      <md-input-container>
        <input type="text" mdInput [(ngModel)]="simulateForm.userid" name="userid" color="warn" placeholder="输入客户端userid" required>
        <md-error>必填</md-error>
      </md-input-container>

      <md-input-container>
        <input type="text" mdInput [(ngModel)]="simulateForm.uuid" name="uuid" color="warn" placeholder="输入客户端uuid" required>
        <md-error>必填</md-error>
      </md-input-container>

      <md-input-container>
        <input type="text" mdInput [(ngModel)]="simulateForm.platform" name="platform" color="warn" placeholder="输入客户端所属平台">
      </md-input-container>

      <div style="text-align: right;">
        <md-slide-toggle checked="simulateForm.activityBroadcast" color="accent" name="activityBroadcast" [(ngModel)]="simulateForm.activityBroadcast">上线/下线提醒</md-slide-toggle>

        <button type="submit" [disabled]="conectionForm.form.invalid" *ngIf="!socketService.ready" md-raised-button color="accent">上线</button>
      </div>
    </div>

    <div *ngIf="socketService.ready">

      <section class="message-list">
        <div class="title">
          <b>userid:</b> {{simulateForm.userid}} <b>uuid:</b> {{simulateForm.uuid}}
        </div>
        <div *ngFor="let item of messageList" class="message" (click)="showMessage(item)">{{item | json}}</div>
      </section>

      <md-input-container>
        <input type="text" mdInput [(ngModel)]="simulateForm.joinRooms" name="joinRooms" color="warn" placeholder="输入房间，已逗号分隔">
        <button type="button" md-raised-button (click)="joinRoom()" [disabled]="!simulateForm.joinRooms" color="accent" mdSuffix>加入房间</button>
      </md-input-container>

      <md-input-container>
        <input type="text" mdInput [(ngModel)]="simulateForm.leaveRooms" name="leaveRooms" color="warn" placeholder="输入房间，已逗号分隔">
        <button type="button" md-raised-button (click)="leaveRoom()" [disabled]="!simulateForm.leaveRooms" color="accent" mdSuffix>离开房间</button>
      </md-input-container>

      <div class="text-center">
        <button type="button" md-raised-button (click)="getClientInfo()" color="accent" mdSuffix>查看信息</button>&nbsp;&nbsp;
        <button type="button" md-raised-button (click)="setClientInfo()" color="accent" mdSuffix>设置信息</button>
      </div>

      <md-input-container>
        <textarea mdInput rows="3" name="clientInfo" [(ngModel)]="simulateForm.clientInfo"></textarea>
      </md-input-container>

      <div class="pull-right">
        <button type="button" md-raised-button color="warn" (click)="disconnect()">下线</button>
      </div>
    </div>
  </form>

</div>